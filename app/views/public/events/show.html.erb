<h2 class="mt-4 d-flex justify-content-center">＜イベント詳細＞</h2>

<div class="row">
  <div class="col-md-9">
    <% if @event.is_niced_by?(current_member) %>
      <p>
        <%= link_to event_is_nice_path(@event), method: :delete do %>
          ♥<%= @event.is_nices.count %> ありがとう!!
        <% end %>
      </p>
    <% else %>
      <p>
        <%= link_to event_is_nice_path(@event), method: :post do %>
          ♡<%= @event.is_nices.count %> ありがとう!!
        <% end %>
      </p>
    <% end %>
    <table class="table table-hover table-inverse">
      <tbody>
        <tr>
          <td colspan=2>
            <div class="d-flex justify-content-center">
              <% if @event.images.attached? %>
                <% @event.images.each do |image| %>
                  <%= image_tag image.variant(resize_to_limit: [100, 100]), class: "mx-2" %>
                <% end %>
              <% else %>
                <% image_tag 'no-image.ipg', style: "wisdth:100px;" %>
              <% end %>
            </div>
          </td>
        </tr>
        <tr>
          <th>イベントタイトル</th>
          <td><%= link_to @event.title, event_path(@event.id) %></td>
        </tr>
        <tr>
          <th>イベント内容</th>
          <td><%= @event.body %></td>
        </tr>
        <tr>
          <th></th>
          <td>
            <%= link_to "編集", edit_event_path(@event.id), class: "btn btn-warning" %> |
            <%= link_to "削除", event_path(@event.id), method: :delete, class: "btn btn-sm btn-danger", "data-confirm" => "本当に削除しますか？" %>
          </td>
        </tr>
        <tr>
          <th>お願いしたい人</th>
          <td>
            <% @event.assign_members.each do |member| %>
              <%= link_to member.name, member_path(member) %>
            <% end %>
          </td>
        </tr>
        <tr>
          <th>お願いしたい人にチェックする</th>
          <td>
            <%= form_with model: @event do |f| %>
              <div class="mb-2">
                <%= f.collection_check_boxes :assign_member_ids, current_member.families, :id, :name %>
              </div>
              <div class="mb-2">
                <%= f.submit "追加する", class: "btn btn-primary" %>
              </div>
            <% end %>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="col-md-3">
    <div class="mb-4">
      <p>コメント件数：<%= @event.comments.count %></p>
      <% @event.comments.each do |comment| %>
        <div class="d-flex justify-content-between">
          <div class="d-flex justify-content-start align-items-center">
            <span class="mr-2"><%= image_tag comment.member.get_image(50,50) %></span>
            <span><%= comment.member.name %></span>
          </div>
          <div class="d-flex justify-content-start align-items-center">
            <span><%= comment.body %></span>
          </div>

          <div class="d-flex justify-content-end align-items-center ">
            <span class="mr-2"><%= comment.created_at.strftime('%Y/%m/%d') %></span>
            <span><%= link_to "削除", comment_path(comment), method: :delete, class: "btn btn-sm btn-danger" if current_member == comment.member %></span>
          </div>
        </div>
      <% end %>
    </div>
    <div class="mb-4">
      <%= form_with model: [@event, @comment] do |f| %>
        <div class="mb-2">
          <%= f.text_area :body, rows: '3', placeholder: "コメントをここに", class: "form-control" %>
        </div>
        <div class="row">
          <div class="col-md-8 offset-md-2">
            <%= f.submit "送る", class: "btn btn-primary btn-block" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<%= link_to "カレンダーへ", events_path, class: "btn btn-secondary" %>